name: Ruby Tests

on:
  workflow_call:
    inputs:
      safe-checkout:
        required: true
        description: "The SHA key for the commit we want to run over"
        type: string

permissions:
  contents: read

jobs:
  linux:
    strategy:
      fail-fast: false
      matrix:
        include:
          # Test both FFI and Native implementations on the highest and lowest
          # Ruby versions for CRuby and JRuby.
          - { name: Ruby 2.7, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 FFI and ASAN 1, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 2, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 3, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 4, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 5, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 6, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 7, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 8, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 9, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 10, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 11, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 12, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 13, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 14, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 15, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 16, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 17, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 18, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 19, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 20, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 21, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 22, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 23, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 24, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 25, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 26, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 27, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 28, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 29, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 30, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 31, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 32, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 33, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 34, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 35, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 36, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 37, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 38, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 39, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 40, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 41, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 42, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 43, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 44, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 45, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 46, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 47, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 48, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 49, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 50, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 51, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 52, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 53, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 54, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 55, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 56, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 57, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 58, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 59, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI and ASAN 60, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 61, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 62, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 63, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 64, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 65, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 66, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 67, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 68, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 69, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 70, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 71, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 72, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 73, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 74, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 75, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 76, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 77, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 78, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 79, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 80, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 81, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 82, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 83, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 84, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 85, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 86, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 87, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 88, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 89, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 90, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 91, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 92, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 93, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 94, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 95, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 96, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 97, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 98, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 99, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
#          - { name: Ruby 2.7 FFI and ASAN 100, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 2.7 FFI without ASAN Iteration 1, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 2, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 3, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 4, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 5, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 6, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 7, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 8, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 9, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 10, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 11, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 12, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 13, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 14, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 15, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 16, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 17, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 18, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 19, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 20, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 21, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 22, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 23, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 24, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 25, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 26, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 27, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 28, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 29, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 30, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 31, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 32, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 33, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 34, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 35, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 36, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 37, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 38, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 39, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 40, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 41, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 42, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 43, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 44, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 45, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 46, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 47, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 48, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 49, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 50, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 51, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 52, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 53, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 54, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 55, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 56, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 57, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 58, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 59, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 FFI without ASAN Iteration 60, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 61, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 62, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 63, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 64, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 65, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 66, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 67, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 68, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 69, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 70, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 71, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 72, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 73, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 74, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 75, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 76, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 77, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 78, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 79, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 80, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 81, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 82, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 83, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 84, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 85, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 86, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 87, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 88, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 89, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 90, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 91, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 92, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 93, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 94, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 95, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 96, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 97, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 98, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 99, ruby: ruby-2.7.0, ffi: FFI }
#          - { name: Ruby 2.7 FFI without ASAN Iteration 100, ruby: ruby-2.7.0, ffi: FFI }
          - { name: Ruby 2.7 Native Iteration 1, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 2, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 3, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 4, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 5, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 6, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 7, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 8, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 9, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 10, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 11, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 12, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 13, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 14, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 15, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 16, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 17, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 18, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 19, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 20, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 21, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 22, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 23, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 24, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 25, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 26, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 27, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 28, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 29, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 30, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 31, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 32, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 33, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 34, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 35, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 36, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 37, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 38, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 39, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 40, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 41, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 42, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 43, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 44, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 45, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 46, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 47, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 48, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 49, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 50, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 51, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 52, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 53, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 54, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 55, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 56, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 57, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 58, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 59, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7 Native Iteration 60, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 61, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 62, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 63, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 64, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 65, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 66, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 67, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 68, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 69, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 70, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 71, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 72, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 73, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 74, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 75, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 76, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 77, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 78, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 79, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 80, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 81, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 82, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 83, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 84, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 85, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 86, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 87, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 88, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 89, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 90, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 91, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 92, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 93, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 94, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 95, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 96, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 97, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 98, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 99, ruby: ruby-2.7.0, ffi: NATIVE }
#          - { name: Ruby 2.7 Native Iteration 100, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 3.0, ruby: ruby-3.0.2 }
          - { name: Ruby 3.1, ruby: ruby-3.1.0 }
          - { name: Ruby 3.2, ruby: ruby-3.2.0 }
          - { name: Ruby 3.3, ruby: ruby-3.3.0, ffi: NATIVE }
          # Disabled, pending resolution of https://github.com/ffi/ffi/issues/1079
          # - { name: Ruby 3.3 Iteration 1, ruby: ruby-3.3.0, ffi: FFI }
          - { name: JRuby 9.4, ruby: jruby-9.4.3.0, ffi: NATIVE }
          - { name: JRuby 9.4, ruby: jruby-9.4.3.0, ffi: FFI }

    name: Linux ${{ matrix.name }}${{ matrix.ffi == 'FFI' && ' FFI' || '' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout pending changes
        uses: protocolbuffers/protobuf-ci/checkout@v2
        with:
          ref: ${{ inputs.safe-checkout }}
      - name: Run tests
        uses: protocolbuffers/protobuf-ci/bazel-docker@v2
        with:
          image: ${{ matrix.image || format('us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby:{0}-6.3.0-904cad5249547845454998ca3837a34c71fabf96', matrix.ruby) }}
          credentials: ${{ secrets.GAR_SERVICE_ACCOUNT }}
          bazel-cache: ruby_linux/${{ matrix.ruby }}_${{ matrix.bazel }}
          bazel: test //ruby/... //ruby/tests:ruby_version --test_env=KOKORO_RUBY_VERSION --test_env=BAZEL=true ${{ matrix.ffi == 'FFI' && matrix.image != '' && '--config=asan --test_env=ASAN_OPTIONS=halt_on_error=0:use_sigaltstack=0:detect_leaks=0' || '' }} ${{ matrix.ffi == 'FFI' && '--//ruby:ffi=enabled --test_env=PROTOCOL_BUFFERS_RUBY_IMPLEMENTATION=FFI' || '' }}

  linux-32bit:
    name: Linux 32-bit
    runs-on: ubuntu-latest
    steps:
      - name: Checkout pending changes
        uses: protocolbuffers/protobuf-ci/checkout@v2
        with:
          ref: ${{ inputs.safe-checkout }}

      - name: Cross compile protoc for i386
        id: cross-compile
        uses: protocolbuffers/protobuf-ci/cross-compile-protoc@v2
        with:
          image: us-docker.pkg.dev/protobuf-build/containers/common/linux/bazel:6.3.0-91a0ac83e968068672bc6001a4d474cfd9a50f1d
          credentials: ${{ secrets.GAR_SERVICE_ACCOUNT }}
          architecture: linux-i386

      - name: Run tests
        uses: protocolbuffers/protobuf-ci/docker@v2
        with:
          image: i386/ruby:2.7.3-buster
          credentials: ${{ secrets.GAR_SERVICE_ACCOUNT }}
          # Pin to Ruby 2.7 compatible bundler version.
          command: >-
            /bin/bash -cex '
            gem install bundler -v 2.4.22;
            cd /workspace/ruby;
            bundle;
            PROTOC=/workspace/${{ steps.cross-compile.outputs.protoc }} rake;
            rake clobber_package gem;
            PROTOC=/workspace/${{ steps.cross-compile.outputs.protoc }} rake test'

  linux-aarch64:
    name: Linux aarch64
    runs-on: ubuntu-latest
    steps:
      - name: Checkout pending changes
        uses: protocolbuffers/protobuf-ci/checkout@v2
        with:
          ref: ${{ inputs.safe-checkout }}

      - name: Cross compile protoc for aarch64
        id: cross-compile
        uses: protocolbuffers/protobuf-ci/cross-compile-protoc@v2
        with:
          image: us-docker.pkg.dev/protobuf-build/containers/common/linux/bazel:6.3.0-91a0ac83e968068672bc6001a4d474cfd9a50f1d
          credentials: ${{ secrets.GAR_SERVICE_ACCOUNT }}
          architecture: linux-aarch64

      - name: Run tests
        uses: protocolbuffers/protobuf-ci/docker@v2
        with:
          image: arm64v8/ruby:2.7.3-buster
          credentials: ${{ secrets.GAR_SERVICE_ACCOUNT }}
          # Pin to Ruby 2.7 compatible bundler version.
          command: >-
            /bin/bash -cex '
            gem install bundler -v 2.4.22;
            cd /workspace/ruby;
            bundle;
            PROTOC=/workspace/${{ steps.cross-compile.outputs.protoc }} rake;
            rake clobber_package gem;
            PROTOC=/workspace/${{ steps.cross-compile.outputs.protoc }} rake test'

  macos:
    strategy:
      fail-fast: false   # Don't cancel all jobs if one fails.
      matrix:
        include:
        # Test both FFI and Native implementations on the highest and lowest
        # Ruby versions for CRuby.
        # Quote versions numbers otherwise 3.0 will render as 3
        - { version: "2.7", ffi: NATIVE }
#        - { version: "2.7", iteration: 1, ffi: FFI }
#        - { version: "2.7", iteration: 2, ffi: FFI }
#        - { version: "2.7", iteration: 3, ffi: FFI }
#        - { version: "2.7", iteration: 4, ffi: FFI }
#        - { version: "2.7", iteration: 5, ffi: FFI }
#        - { version: "2.7", iteration: 6, ffi: FFI }
#        - { version: "2.7", iteration: 7, ffi: FFI }
#        - { version: "2.7", iteration: 8, ffi: FFI }
#        - { version: "2.7", iteration: 9, ffi: FFI }
#        - { version: "2.7", iteration: 10, ffi: FFI }
#        - { version: "2.7", iteration: 11, ffi: FFI }
#        - { version: "2.7", iteration: 12, ffi: FFI }
#        - { version: "2.7", iteration: 13, ffi: FFI }
#        - { version: "2.7", iteration: 14, ffi: FFI }
#        - { version: "2.7", iteration: 15, ffi: FFI }
#        - { version: "2.7", iteration: 16, ffi: FFI }
#        - { version: "2.7", iteration: 17, ffi: FFI }
#        - { version: "2.7", iteration: 18, ffi: FFI }
#        - { version: "2.7", iteration: 19, ffi: FFI }
#        - { version: "2.7", iteration: 20, ffi: FFI }
#        - { version: "2.7", iteration: 21, ffi: FFI }
#        - { version: "2.7", iteration: 22, ffi: FFI }
#        - { version: "2.7", iteration: 23, ffi: FFI }
#        - { version: "2.7", iteration: 24, ffi: FFI }
#        - { version: "2.7", iteration: 25, ffi: FFI }
#        - { version: "2.7", iteration: 26, ffi: FFI }
#        - { version: "2.7", iteration: 27, ffi: FFI }
#        - { version: "2.7", iteration: 28, ffi: FFI }
#        - { version: "2.7", iteration: 29, ffi: FFI }
#        - { version: "2.7", iteration: 30, ffi: FFI }
#        - { version: "2.7", iteration: 31, ffi: FFI }
#        - { version: "2.7", iteration: 32, ffi: FFI }
#        - { version: "2.7", iteration: 33, ffi: FFI }
#        - { version: "2.7", iteration: 34, ffi: FFI }
#        - { version: "2.7", iteration: 35, ffi: FFI }
#        - { version: "2.7", iteration: 36, ffi: FFI }
#        - { version: "2.7", iteration: 37, ffi: FFI }
#        - { version: "2.7", iteration: 38, ffi: FFI }
#        - { version: "2.7", iteration: 39, ffi: FFI }
#        - { version: "2.7", iteration: 40, ffi: FFI }
#        - { version: "2.7", iteration: 41, ffi: FFI }
#        - { version: "2.7", iteration: 42, ffi: FFI }
#        - { version: "2.7", iteration: 43, ffi: FFI }
#        - { version: "2.7", iteration: 44, ffi: FFI }
#        - { version: "2.7", iteration: 45, ffi: FFI }
#        - { version: "2.7", iteration: 46, ffi: FFI }
#        - { version: "2.7", iteration: 47, ffi: FFI }
#        - { version: "2.7", iteration: 48, ffi: FFI }
#        - { version: "2.7", iteration: 49, ffi: FFI }
#        - { version: "2.7", iteration: 50, ffi: FFI }
        - { version: "3.0", ffi: NATIVE }
        - { version: "3.1", ffi: NATIVE }
        - { version: "3.2", ffi: NATIVE }
        - { version: "3.3", ffi: NATIVE }
        # Disabled, pending resolution of https://github.com/ffi/ffi/issues/1079
        #- { version: "3.3", ffi: FFI }

    name: MacOS Ruby ${{ matrix.version }}${{ matrix.iteration == '' && '' || ' ' }}${{ matrix.iteration || '' }}${{ matrix.ffi == 'FFI' && ' FFI' || '' }}
    runs-on: macos-12
    steps:
      - name: Checkout pending changes
        uses: protocolbuffers/protobuf-ci/checkout@v2
        with:
          ref: ${{ inputs.safe-checkout }}

      - name: Pin Ruby version
        uses: ruby/setup-ruby@961f85197f92e4842e3cb92a4f97bd8e010cdbaf # v1.165.0
        with:
          ruby-version: ${{ matrix.version }}

      - name: Validate version
        run: ruby --version | grep ${{ matrix.version }} || (echo "Invalid Ruby version - $(ruby --version)" && exit 1)

      - name: Run tests
        uses: protocolbuffers/protobuf-ci/bazel@v2
        with:
          credentials: ${{ secrets.GAR_SERVICE_ACCOUNT }}
          bazel-cache: ruby_macos/${{ matrix.version }}
          bazel: test //ruby/... --test_env=KOKORO_RUBY_VERSION=${{ matrix.version }} --test_env=BAZEL=true ${{ matrix.ffi == 'FFI' && '--//ruby:ffi=enabled --test_env=PROTOCOL_BUFFERS_RUBY_IMPLEMENTATION=FFI' || '' }}

  test_ruby_gems:
    strategy:
      fail-fast: false
      matrix:
        include:
          # Test both FFI and Native implementations on the highest and lowest
          # Ruby versions for CRuby and JRuby, but only on Bazel 5.x.
          - { name: Ruby 2.7, ruby: ruby-2.7.0, ffi: NATIVE }
          - { name: Ruby 2.7, ruby: ruby-2.7.0, ffi: FFI, image: "us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby-asan-gcc@sha256:62fe3bdfdc3798a96d7681b7cb3a4d9d7ded64291a05bfd511c409d419395671" }
          - { name: Ruby 3.0, ruby: ruby-3.0.2}
          - { name: Ruby 3.1, ruby: ruby-3.1.0}
          - { name: Ruby 3.2, ruby: ruby-3.2.0}
          - { name: Ruby 3.3, ruby: ruby-3.3.0, ffi: NATIVE }
          - { name: Ruby 3.3, ruby: ruby-3.3.0, ffi: FFI }
          - { name: JRuby 9.4, ruby: jruby-9.4.3.0, ffi: NATIVE }
          - { name: JRuby 9.4, ruby: jruby-9.4.3.0, ffi: FFI }
    name: Install ${{ matrix.name }}${{ matrix.ffi == 'FFI' && ' FFI' || '' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout pending changes
        uses: protocolbuffers/protobuf-ci/checkout@v2
        with:
          ref: ${{ inputs.safe-checkout }}
      - name: Run tests
        uses: protocolbuffers/protobuf-ci/bazel-docker@v2
        with:
          image: us-docker.pkg.dev/protobuf-build/containers/test/linux/ruby:${{ matrix.ruby }}-6.3.0-904cad5249547845454998ca3837a34c71fabf96
          credentials: ${{ secrets.GAR_SERVICE_ACCOUNT }}
          bazel-cache: ruby_install/${{ matrix.ruby }}_${{ matrix.bazel }}
          bash: >
            bazel --version;
            ruby --version;
            ./regenerate_stale_files.sh $BAZEL_FLAGS;
            bazel build //ruby:release //:protoc ${{ matrix.ffi == 'FFI' && '--//ruby:ffi=enabled' || '' }} $BAZEL_FLAGS;
            gem install bazel-bin/ruby/google-protobuf-*;
            bazel-bin/protoc --proto_path=src --proto_path=ruby/tests --proto_path=ruby --ruby_out=ruby tests/test_import_proto2.proto;
            bazel-bin/protoc --proto_path=src --proto_path=ruby/tests --proto_path=ruby --ruby_out=ruby tests/basic_test.proto;
            ${{ matrix.ffi == 'FFI' && 'PROTOCOL_BUFFERS_RUBY_IMPLEMENTATION=FFI' || '' }} ruby ruby/tests/basic.rb;
            ${{ matrix.ffi == 'FFI' && 'PROTOCOL_BUFFERS_RUBY_IMPLEMENTATION=FFI' || '' }} ruby ruby/tests/implementation.rb
